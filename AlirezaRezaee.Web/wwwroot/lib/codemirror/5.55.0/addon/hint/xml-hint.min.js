!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(L){"use strict";var k=L.Pos;function H(t,e,r){return r?0<=t.indexOf(e):0==t.lastIndexOf(e,0)}L.registerHelper("hint","xml",function(t,e){var r=e&&e.schemaInfo,n=e&&e.quoteChar||'"',s=e&&e.matchInMiddle;if(r){var i=t.getCursor(),o=t.getTokenAt(i);if(o.end>i.ch&&(o.end=i.ch,o.string=o.string.slice(0,i.ch-o.start)),(p=L.innerMode(t.getMode(),o.state)).mode.xmlCurrentTag){var a,l,g,c=[],h=!1,f=/\btag\b/.test(o.type)&&!/>$/.test(o.string),u=f&&/^\w/.test(o.string);u?(M=t.getLine(i.line).slice(Math.max(0,o.start-2),o.start),(g=/<\/$/.test(M)?"close":/<$/.test(M)?"open":null)&&(l=o.start-("close"==g?2:1))):f&&"<"==o.string?g="open":f&&"</"==o.string&&(g="close");var d=p.mode.xmlCurrentTag(p.state);if(!f&&!d||g){u&&(a=o.string),h=g;var p,m=p.mode.xmlCurrentContext?p.mode.xmlCurrentContext(p.state):[],v=(p=m.length&&m[m.length-1])&&r[p],y=p?v&&v.children:r["!top"];if(y&&"close"!=g)for(var x=0;x<y.length;++x)a&&!H(y[x],a,s)||c.push("<"+y[x]);else if("close"!=g)for(var C in r)!r.hasOwnProperty(C)||"!top"==C||"!attrs"==C||a&&!H(C,a,s)||c.push("<"+C);p&&(!a||"close"==g&&H(p,a,s))&&c.push("</"+p+">")}else{var b=(v=d&&r[d.name])&&v.attrs,O=r["!attrs"];if(!b&&!O)return;if(b){if(O){var w={};for(var A in O)O.hasOwnProperty(A)&&(w[A]=O[A]);for(var A in b)b.hasOwnProperty(A)&&(w[A]=b[A]);b=w}}else b=O;if("string"==o.type||"="==o.string){var M,P,$,I,T,j=(M=t.getRange(k(i.line,Math.max(0,i.ch-60)),k(i.line,"string"==o.type?o.start:o.end))).match(/([^\s\u00a0=<>\"\']+)=$/);if(!j||!b.hasOwnProperty(j[1])||!(P=b[j[1]]))return;"function"==typeof P&&(P=P.call(this,t)),"string"==o.type&&(a=o.string,$=0,/['"]/.test(o.string.charAt(0))&&(n=o.string.charAt(0),a=o.string.slice(1),$++),I=o.string.length,/['"]/.test(o.string.charAt(I-1))&&(n=o.string.charAt(I-1),a=o.string.substr($,I-2)),!$||(T=t.getLine(i.line)).length>o.end&&T.charAt(o.end)==n&&o.end++,h=!0);for(x=0;x<P.length;++x)a&&!H(P[x],a,s)||c.push(n+P[x]+n)}else for(var q in"attribute"==o.type&&(a=o.string,h=!0),b)!b.hasOwnProperty(q)||a&&!H(q,a,s)||c.push(q)}return{list:c,from:h?k(i.line,null==l?o.start:l):i,to:h?k(i.line,o.end):i}}}})});